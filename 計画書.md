# DiffLens 開発計画書

## 現状サマリー

| 項目 | 状態 |
|------|------|
| バージョン | v0.0.1 |
| npm公開準備 | 完了 |
| テストカバレッジ | 25テスト（基本カバー） |
| CI/CD | GitHub Actions設定済み |
| ドキュメント | README, CHANGELOG完備 |

---

## Phase 5: npm公開 & 初期フィードバック収集

**目標**: npmに公開し、初期ユーザーからフィードバックを得る

### タスク

| # | タスク | 優先度 | 詳細 |
|---|--------|--------|------|
| 5.1 | package.json完成 | 必須 | `author`, `repository`, `homepage`, `bugs` フィールドを設定 |
| 5.2 | GitHubリポジトリ作成 | 必須 | パブリックリポジトリを作成、コードをpush |
| 5.3 | npm公開 | 必須 | `npm publish` でv0.0.1を公開 |
| 5.4 | CI/CDのpublishジョブ有効化 | 推奨 | タグプッシュ時の自動公開を設定 |
| 5.5 | SNS/コミュニティへの告知 | 推奨 | X(Twitter), Reddit, Hacker Newsなどで告知 |

### 成功指標
- npm週間ダウンロード数: 100+
- GitHub Star: 10+
- Issue/フィードバック: 5件以上

---

## Phase 6: 機能強化 (v0.1.0)

**目標**: ユーザーフィードバックを元に実用性を向上

### 6.1 レポート機能の強化

| タスク | 詳細 |
|--------|------|
| インタラクティブHTMLレポート | 差分画像のオーバーレイ表示、スライダー比較 |
| スクリーンショットのサムネイル | レポート内でのプレビュー表示 |
| フィルタリング機能 | Pass/Fail/Newでの絞り込み |

### 6.2 テスト安定性の向上

| タスク | 詳細 |
|--------|------|
| スマート待機 | `networkidle` に加え、特定要素の出現を待機するオプション |
| リトライ機能強化 | 失敗時の自動リトライ回数を設定可能に |
| ベースライン更新コマンド | `difflens update` で選択的にベースラインを更新 |

### 6.3 設定の柔軟性

| タスク | 詳細 |
|--------|------|
| グローバル設定 | `~/.difflensrc` でのデフォルト設定 |
| 環境変数サポート | `DIFFLENS_THRESHOLD` などの環境変数対応 |
| 設定の継承 | ベース設定を拡張する機能 |

---

## Phase 7: SaaS基盤構築 (v0.2.0)

**目標**: クラウドサービスとしての基盤を構築

### 7.1 バックエンド

| タスク | 技術選定 |
|--------|----------|
| 認証システム | Clerk / Auth0 / Firebase Auth |
| データベース | PostgreSQL (Supabase / Neon) |
| ストレージ | S3 / Cloudflare R2（スクリーンショット保存） |
| ジョブキュー | BullMQ / Inngest（テスト実行のキューイング） |

### 7.2 インフラ

| タスク | 詳細 |
|--------|------|
| コンテナ化 | Docker Compose → Kubernetes対応 |
| CDN | Cloudflare / Vercel Edge |
| モニタリング | Sentry, Datadog |

### 7.3 API拡張

| エンドポイント | 用途 |
|----------------|------|
| `POST /projects` | プロジェクト作成 |
| `POST /projects/:id/runs` | テスト実行開始 |
| `GET /projects/:id/runs/:runId` | 実行結果取得 |
| `POST /projects/:id/baseline/approve` | ベースライン承認 |
| `GET /webhooks` | Webhook設定 |

---

## Phase 8: AI統合強化 (v0.3.0)

**目標**: AIエージェントとの連携を深化

### 8.1 MCP Server強化

| タスク | 詳細 |
|--------|------|
| 複数ツール追加 | `difflens_list_scenarios`, `difflens_approve_baseline` |
| ストリーミング対応 | 進捗をリアルタイムで返す |
| コンテキスト情報 | プロジェクト設定、過去の実行履歴を含める |

### 8.2 AI分析機能

| タスク | 詳細 |
|--------|------|
| 差分の自動分類 | 「レイアウト変更」「色変更」「テキスト変更」などを自動判定 |
| 修正提案生成 | 差分に基づいたCSS/HTML修正案をAIが生成 |
| 自動承認判定 | 軽微な変更（1px未満のズレなど）を自動承認 |

### 8.3 エージェント向けSDK

```typescript
// 将来的なSDKイメージ
import { DiffLensAgent } from 'difflens/agent';

const agent = new DiffLensAgent({ apiKey: '...' });
const result = await agent.checkAndFix('https://example.com');
// AIが自動で差分を検出し、修正PRを作成
```

---

## Phase 9: エンタープライズ機能 (v1.0.0)

**目標**: 企業向け機能を追加し、有料プランを展開

### 9.1 チーム機能

| タスク | 詳細 |
|--------|------|
| 組織管理 | チーム作成、メンバー招待 |
| 権限管理 | Admin / Developer / Viewer ロール |
| 監査ログ | すべての操作を記録 |

### 9.2 CI/CD統合

| タスク | 詳細 |
|--------|------|
| GitHub App | PRにコメントで結果を表示 |
| GitLab CI | `.gitlab-ci.yml` テンプレート |
| Jenkins Plugin | Jenkins用プラグイン |

### 9.3 高度な比較機能

| タスク | 詳細 |
|--------|------|
| クロスブラウザ | Chrome, Firefox, Safari, Edge対応 |
| レスポンシブテスト | 複数デバイスサイズの一括テスト |
| パフォーマンス計測 | Core Web Vitalsの計測・比較 |

---

## 料金プラン案

| プラン | 価格 | 内容 |
|--------|------|------|
| Free | $0 | 100テスト/月, 1プロジェクト |
| Pro | $29/月 | 無制限テスト, 10プロジェクト, チーム3人 |
| Team | $99/月 | 無制限, 無制限プロジェクト, チーム無制限 |
| Enterprise | 要問合せ | SSO, 監査ログ, 専用サポート |

---

## ロードマップ

```
2025 Q1: Phase 5 (npm公開)
         └─ v0.0.1 公開、初期フィードバック収集

2025 Q2: Phase 6 (機能強化)
         └─ v0.1.0 リリース

2025 Q3: Phase 7 (SaaS基盤)
         └─ v0.2.0 ベータ版ローンチ

2025 Q4: Phase 8 (AI統合)
         └─ v0.3.0 AI機能リリース

2026 Q1: Phase 9 (エンタープライズ)
         └─ v1.0.0 正式リリース、有料プラン開始
```

---

## 直近の優先タスク（今週〜来週）

1. [ ] GitHubリポジトリ作成
2. [ ] package.jsonに `author`, `repository` を設定
3. [ ] npmアカウント作成/確認
4. [ ] `npm publish` 実行
5. [ ] README にバッジ追加（npm version, CI status, license）
6. [ ] X(Twitter) で告知投稿を作成

---

## リスクと対策

| リスク | 対策 |
|--------|------|
| Playwrightの依存が重い | 軽量モード（puppeteer-core対応）を検討 |
| 競合ツール（Percy, Chromatic） | AI統合とMCP対応で差別化 |
| SaaS運用コスト | サーバーレス構成で初期コスト最小化 |
| セキュリティ | 定期的な依存関係の監査、Snyk導入 |

---

## 参考リンク

- [Percy](https://percy.io/) - 競合分析
- [Chromatic](https://www.chromatic.com/) - 競合分析
- [MCP Specification](https://modelcontextprotocol.io/) - MCP仕様
- [Playwright Docs](https://playwright.dev/) - 技術基盤
